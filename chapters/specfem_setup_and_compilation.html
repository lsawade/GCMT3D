

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Specfem Setup and compilation &mdash; gcmt3d 0.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Create a Database Entry" href="creating_the_database.html" />
    <link rel="prev" title="Introduction" href="introduction.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> gcmt3d
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Specfem Setup and compilation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#setting-up-the-compilers">Setting up the compilers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setting-up-specfem">Setting up <code class="docutils literal notranslate"><span class="pre">specfem</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-par-file-and-configuration">1. The <code class="docutils literal notranslate"><span class="pre">Par_file</span></code> and Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-specfem">2. Running <code class="docutils literal notranslate"><span class="pre">specfem</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#sample-specfem-parameter-file">Sample Specfem parameter file</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="creating_the_database.html">Create a Database Entry</a></li>
<li class="toctree-l1"><a class="reference internal" href="request_data.html">Request Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="perturb_sources.html">Perturbation of Specfem Source</a></li>
<li class="toctree-l1"><a class="reference internal" href="running_specfem.html">Creating Synthetics</a></li>
<li class="toctree-l1"><a class="reference internal" href="running_specfem.html#cleaning-the-simulation-directories">Cleaning the simulation directories</a></li>
<li class="toctree-l1"><a class="reference internal" href="conversion.html">Conversion of the Synthetic and Observed Data to ASDF</a></li>
<li class="toctree-l1"><a class="reference internal" href="processing.html">Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="gcmt3dAPI.html">GCMT3D API</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">gcmt3d</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Specfem Setup and compilation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/chapters/specfem_setup_and_compilation.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="specfem-setup-and-compilation">
<h1>Specfem Setup and compilation<a class="headerlink" href="#specfem-setup-and-compilation" title="Permalink to this headline">¶</a></h1>
<p>The package also includes a specfem configuration and parameter setup class.
It is not necessary to set it up, compile etc. if you already have setup
specfem, but it is necessary to set the correct flags in the SpecfemParameter
file.</p>
<div class="section" id="setting-up-the-compilers">
<h2>Setting up the compilers<a class="headerlink" href="#setting-up-the-compilers" title="Permalink to this headline">¶</a></h2>
<p>It is important that specfem is both built and run with the same set of
compilers. The best thing is to ask your Sysadmin if you are unsure about the
available ones. For the Tiger Cluster at Princeton, the following setup of
compilers is used</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Modules</span>
<span class="nt">modulelist</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">intel</span><span class="p p-Indicator">,</span> <span class="nv">openmpi</span><span class="p p-Indicator">]</span>
<span class="nt">gpu_module</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cudatoolkit</span>

<span class="c1"># C compiler</span>
<span class="nt">cc</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">icc</span>

<span class="c1"># C++ Comiler</span>
<span class="nt">cpp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">icpc</span>

<span class="c1"># Fortran Compiler</span>
<span class="nt">f90</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ifort</span>

<span class="c1"># MPI C Compiler</span>
<span class="nt">mpicc</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mpicc</span>

<span class="c1"># MPI Fortran Compiler</span>
<span class="nt">mpif90</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mpifort</span>
</pre></div>
</div>
<p>The modules are used to load the specific compilers which are then specified
by name. These are set in the <code class="docutils literal notranslate"><span class="pre">params/SpecfemParams/CompilersAndModules.yml</span></code></p>
</div>
<div class="section" id="setting-up-specfem">
<h2>Setting up <code class="docutils literal notranslate"><span class="pre">specfem</span></code><a class="headerlink" href="#setting-up-specfem" title="Permalink to this headline">¶</a></h2>
<p>There are three main steps in getting specfem to run.</p>
<ol class="arabic simple">
<li><p>Set Values in the <code class="docutils literal notranslate"><span class="pre">Par_file</span></code> Configure the compilation setup.</p></li>
<li><p>Running <code class="docutils literal notranslate"><span class="pre">specfem3d_globe</span></code></p></li>
</ol>
<div class="section" id="the-par-file-and-configuration">
<h3>1. The <code class="docutils literal notranslate"><span class="pre">Par_file</span></code> and Configuration<a class="headerlink" href="#the-par-file-and-configuration" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">Par_file</span></code> can be set using the parameter file
<code class="docutils literal notranslate"><span class="pre">params/SpecfemParams/SpecfemParams.yml</span></code>. Here all parameters, such as the
length of the recording, the resolution, GPU or CPU runs etc. can be set.
Then, running the specfem can be configured and recompiled using the
<code class="docutils literal notranslate"><span class="pre">DATAFixer</span></code> class or the script <code class="docutils literal notranslate"><span class="pre">00_Fix_Specfem_And_Recompile.py</span></code> which
directly takes in the <code class="docutils literal notranslate"><span class="pre">YAML</span></code> parameter file you have set, fixes the specfem
<code class="docutils literal notranslate"><span class="pre">Par_file</span></code>, configures, recompiles and creates the mesh.</p>
</div>
<div class="section" id="running-specfem">
<h3>2. Running <code class="docutils literal notranslate"><span class="pre">specfem</span></code><a class="headerlink" href="#running-specfem" title="Permalink to this headline">¶</a></h3>
<p>Already now, specfem could be run using the <code class="docutils literal notranslate"><span class="pre">run_solver()</span></code> method of the
<code class="docutils literal notranslate"><span class="pre">DATAFixer</span></code> class, but where is the fun in that! The next step is to create
an earthquake database or an entry into an existing database so that
meaningful simulations can be run of which the simulated data can be inverted
for new earthquake solutions.</p>
</div>
</div>
<div class="section" id="sample-specfem-parameter-file">
<h2>Sample Specfem parameter file<a class="headerlink" href="#sample-specfem-parameter-file" title="Permalink to this headline">¶</a></h2>
<p>The following shows an example of a <code class="docutils literal notranslate"><span class="pre">SpecfemParams.yml</span></code> parameter file.
which is used to compile specfem in the beginning.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># directory where specfem is compiled</span>
<span class="nt">SPECFEM_DIR</span><span class="p">:</span> <span class="s">&quot;/scratch/gpfs/lsawade/specfem3d_globe_gpu&quot;</span>

<span class="c1"># Set MPI Parameters</span>
<span class="nt">NEX_XI</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">128</span>
<span class="nt">NEX_ETA</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">128</span>
<span class="nt">NPROC_XI</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="nt">NPROC_ETA</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>

<span class="c1"># GPU Parameters</span>
<span class="nt">GPU_MODE</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="nt">GPU_RUNTIME</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="nt">GPU_PLATFORM</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">NVIDIA</span>
<span class="nt">GPU_DEVICE</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Tesla</span>

<span class="c1"># ADIOS PARAMETERS</span>
<span class="nt">ADIOS_ENABLED</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="nt">ADIOS_FOR_FORWARD_ARRAYS</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="nt">ADIOS_FOR_MPI_ARRAYS</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="nt">ADIOS_FOR_ARRAYS_SOLVER</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="nt">ADIOS_FOR_SOLVER_MESHFILES</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="nt">ADIOS_FOR_AVS_DX</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="nt">ADIOS_FOR_KERNELS</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="nt">ADIOS_FOR_MODELS</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="nt">ADIOS_FOR_UNDO_ATTENUATION</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>

<span class="c1"># Minimal Processing</span>
<span class="nt">ROTATE_SEISMOGRAMS_RT</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">False</span> <span class="c1"># Rotates the seismograms to RTZ</span>
<span class="nt">RECORD_LENGTH</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">125</span>
<span class="nt">MODEL</span><span class="p">:</span> <span class="s">&quot;s362ani&quot;</span>

<span class="c1"># Output style</span>
<span class="nt">WRITE_SEISMOGRAMS_BY_MASTER</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="nt">OUTPUT_SEISMOS_ASCII_TEXT</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="nt">OUTPUT_SEISMOS_SAC_ALPHANUM</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="nt">OUTPUT_SEISMOS_SAC_BINARY</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="nt">OUTPUT_SEISMOS_ASDF</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>

<span class="c1"># Visualization (Should be set to False)</span>
<span class="nt">MOVIE_SURFACE</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="nt">MOVIE_VOLUME</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="nt">MOVIE_COARSE</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">False</span>

<span class="c1"># Computational Resources</span>
<span class="nt">nodes</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="nt">tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">6</span>
<span class="nt">tasks_per_node</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>  <span class="c1"># Unused for CPU runs</span>
<span class="nt">walltime</span><span class="p">:</span> <span class="s">&quot;00:20:00&quot;</span>
<span class="nt">walltime_solver</span><span class="p">:</span> <span class="s">&quot;00:15:00&quot;</span>  <span class="c1"># Solver usually</span>
<span class="nt">memory_req</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">40000</span>  <span class="c1"># Memory to be requested for run in MB. Unused for CPU runs.</span>


<span class="c1"># Verbose output</span>
<span class="nt">verbose</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="creating_the_database.html" class="btn btn-neutral float-right" title="Create a Database Entry" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="introduction.html" class="btn btn-neutral float-left" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Lucas Sawade

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>